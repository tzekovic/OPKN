<%- include('../partials/header') %>

<div class="container">
    <h1>Search Books</h1>
    
    <!-- Search Form -->
    <div class="card" style="margin-bottom: 30px;">
        <form action="/search" method="GET" style="display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center;">
            <div>
                <label for="q">Keywords</label>
                <input type="text" name="q" id="q" value="<%= query.q || '' %>" placeholder="Title, Author..." style="width: 100%; padding: 8px;">
            </div>
            
            <div>
                <label for="genre">Genre</label>
                <select name="genre" id="genre" style="width: 100%; padding: 8px;">
                    <option value="">Any Genre</option>
                    <% genres.forEach(g => { %>
                        <option value="<%= g.id %>" <%= query.genre == g.id ? 'selected' : '' %>><%= g.name %></option>
                    <% }) %>
                </select>
            </div>

            <div>
                <label for="city">City</label>
                <select name="city" id="city" style="width: 100%; padding: 8px;">
                    <option value="">Any City</option>
                    <% cities.forEach(c => { %>
                        <option value="<%= c.id %>" <%= query.city == c.id ? 'selected' : '' %>><%= c.name %></option>
                    <% }) %>
                </select>
            </div>

            <div>
                <label for="maxPrice">Max Price</label>
                <input type="number" name="maxPrice" id="maxPrice" value="<%= query.maxPrice || '' %>" placeholder="e.g. 50" style="width: 100%; padding: 8px;">
            </div>

            <div>
                <button type="submit" class="btn" style="width: 100%;">Filter</button>
            </div>
        </form>
    </div>

    <!-- Results -->
    <% if (books.length === 0) { %>
        <p>No books found matching your criteria.</p>
    <% } else { %>
        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px;">
            <% books.forEach(book => { %>
                <div class="card">
                    <a href="/books/<%= book.id %>" style="text-decoration: none; color: inherit;">
                        <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                            <% if (book.image_url) { %>
                                <img src="<%= book.image_url %>" alt="<%= book.title %>" style="width: 80px; height: 120px; object-fit: cover;">
                            <% } else { %>
                                <div style="width: 80px; height: 120px; background: #eee;"></div>
                            <% } %>
                            <div>
                                <h3 style="margin: 0; font-size: 1.1rem;"><%= book.title %></h3>
                                <p style="margin: 5px 0; color: #666;"><%= book.author %></p>
                                <p style="font-weight: bold; color: var(--primary-color);">
                                    <%= book.price > 0 ? '$' + book.price : 'Exchange Only' %>
                                </p>
                            </div>
                        </div>
                        <div style="font-size: 0.9rem; color: #555;">
                            <span style="background: #eee; padding: 2px 5px; border-radius: 4px;"><%= book.genre_name %></span>
                            <span style="background: #eee; padding: 2px 5px; border-radius: 4px;"><%= book.city_name %></span>
                        </div>
                    </a>
                </div>
            <% }) %>
        </div>
    <% } %>

</div>

<%- include('../partials/footer') %>
